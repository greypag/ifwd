function bsvFormLogin(e){e.find("input[name='userName']").on("keypress",function(e){validationUsername(e)}),e.find(".btn-submit").on("click",function(){if(e.data("bootstrapValidator").validate(),e.data("bootstrapValidator").isValid()){userName=$("#appointmentloginUsername").val();var a={userName:$("#appointmentloginUsername").val(),password:$("#appointmentloginPassword").val()};$.ajax({beforeSend:function(){$("#loading-overlay").modal("show")},url:fwdApi.url.login,type:"post",contentType:"application/json",data:JSON.stringify(a),cache:!1,async:!1,error:function(e){$(".loginPanErrMsg").append($("<small/>").text(e.responseJSON.message))},success:function(e){e&&(isLogged=!0,$(".after-login").find(".fld-val").text(e.fullName),$(".before-login").hide(),$(".after-login").show(),$("#btn-appointment-confirm").show())},complete:function(){$("#loading-overlay").modal("hide")}})}}),e.bootstrapValidator({fields:{userName:{container:".userNameErrMsg",validators:{callback:{message:"",callback:function(){var a=!0,t=e.find("input[name='userName']"),r=$.trim(t.val()),n=t.parents(".form-group").find("small[data-bv-validator='callback']"),o=isValidUsername(r);return console.log(o),1!=o&&(n.text(o),a=!1),a}}}},password:{container:".passwordErrMsg",validators:{notEmpty:{message:getBundle(getBundleLanguage,"form.credit.card.number.empty")}}}}})}function bsvFormForgotUsername(e){e.find(".btn-submit").on("click",function(){if(e.data("bootstrapValidator").validate(),e.data("bootstrapValidator").isValid()){var a={email:$("#appointmentForgotUsernameEmailAddress").val(),mobileNum:$("#appointmentForgotUsernameMobileNo").val()};$.ajax({beforeSend:function(){$("#loading-overlay").modal("show")},url:fwdApi.url.retrieveUserName,type:"get",contentType:"application/json",data:a,cache:!1,async:!1,error:function(e){$(".forgotUsernamePanErrMsg").append($("<small/>").text(e.responseJSON.message))},success:function(e){e&&$(".forgotUsernamePanErrMsg").append($("<small/>").text("Please check your email"))},complete:function(){$("#loading-overlay").modal("hide")}})}}),e.find("input[name='mobileNo']").on("keypress",function(e){return isNumeric(e)}),e.find("input[name='emailAddress']").on("keypress",function(e){return validationEmail(e)}),e.bootstrapValidator({fields:{mobileNo:{container:".mobileNoErrMsg",validators:{callback:{message:"",callback:function(){var a=!0,t=e.find("input[name='mobileNo']"),r=$.trim(t.val()),n=t.parents(".form-group").find("small[data-bv-validator='callback']");return""==r?(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1):0==mobile_pattern.test(r)&&(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1),a}}}},emailAddress:{container:".emailAddressErrMsg",validators:{callback:{message:"",callback:function(){var a=!0,t=e.find("input[name='emailAddress']"),r=$.trim(t.val()),n=t.parents(".form-group").find("small[data-bv-validator='callback']");return""==r?(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1):0==emailreg.test(r)&&(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1),a}}}}}})}function bsvFormForgotPwd(e){e.find("input[name='mobileNo']").on("keypress",function(e){return isNumeric(e)}),e.find("input[name='emailAddress']").on("keypress",function(e){return validationEmail(e)}),e.find("input[name='userName']").on("keypress",function(e){return validationUsername(e)}),e.find(".btn-submit").on("click",function(){if(e.data("bootstrapValidator").validate(),e.data("bootstrapValidator").isValid()){var a={email:$("#appointmentForgotPwdEmailAddress").val(),mobileNum:$("#appointmentForgotPwdMobileNo").val(),userName:$("#appointmentForgotPwdUsername").val()};$.ajax({beforeSend:function(){$("#loading-overlay").modal("show")},url:fwdApi.url.forgotPassword,type:"get",contentType:"application/json",data:a,cache:!1,async:!1,error:function(e){$(".forgotPwdPanErrMsg").append($("<small/>").text(e.responseJSON.message))},success:function(e){e&&$(".forgotPwdPanErrMsg").append($("<small/>").text("Please check your email"))},complete:function(){$("#loading-overlay").modal("hide")}})}}),e.bootstrapValidator({fields:{mobileNo:{container:".mobileNoErrMsg",validators:{callback:{message:"",callback:function(){var a=!0,t=e.find("input[name='mobileNo']"),r=$.trim(t.val()),n=t.parents(".form-group").find("small[data-bv-validator='callback']");return""==r?(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1):0==mobile_pattern.test(r)&&(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1),a}}}},emailAddress:{container:".emailAddressErrMsg",validators:{callback:{message:"",callback:function(){var a=!0,t=e.find("input[name='emailAddress']"),r=$.trim(t.val()),n=t.parents(".form-group").find("small[data-bv-validator='callback']");return""==r?(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1):0==emailreg.test(r)&&(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1),a}}}},userName:{container:".userNameErrMsg",validators:{callback:{message:"",callback:function(){var a=!0,t=e.find("input[name='userName']"),r=$.trim(t.val()),n=t.parents(".form-group").find("small[data-bv-validator='callback']");return""==r?(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1):isAccountNumeric(r)?(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1):plan_user.test(r)?(r.length<6||r.length>50)&&(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1):(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1),a}}}}}})}function bsvFormRegister(e){e.find(".btn-submit").on("click",function(){if(e.data("bootstrapValidator").validate(),e.data("bootstrapValidator").isValid()){var a={confirmPassword:$("#appointmentRegisterConfPass").val(),email:$("#appointmentRegisterEmailAddress").val(),fullName:$("#appointmentRegisterFullName").val(),mobileNo:$("#appointmentRegisterMobileNo").val(),optOut1:$("#checkbox3").val(),optOut2:$("#checkbox4").val(),password:$("#appointmentRegisterPassword").val(),userName:$("#appointmentRegisterUserName").val()};$.ajax({beforeSend:function(){$("#loading-overlay").modal("show")},url:fwdApi.url.member,type:"post",contentType:"application/json",data:JSON.stringify(a),cache:!1,async:!1,error:function(e){$(".regPanErrMsg").append($("<small/>").text(e.responseJSON.message))},success:function(e){e&&(isLogged=!0,console.log(e),$(".after-login").find(".fld-val").text(e.fullName),userName=e.userName,$(".before-login").hide(),$(".after-login").show(),$("#btn-appointment-confirm").show())},complete:function(){$("#loading-overlay").modal("hide")}})}}),e.find("input[name='EmailAddress']").on("keypress",function(e){return validationEmail(e)}),e.find("input[name='userName']").on("keypress",function(e){return validationUsername(e)}),e.bootstrapValidator({fields:{fullName:{container:".FullNameErrMsg",validators:{callback:{message:"",callback:function(){var a=!0,t=e.find("input[name='fullName']"),r=$.trim(t.val()),n=t.parents(".form-group").find("small[data-bv-validator='callback']");return""==r&&(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1),a}}}},mobileNo:{container:".mobileNoErrMsg",validators:{callback:{message:"",callback:function(){var a=!0,t=e.find("input[name='mobileNo']"),r=$.trim(t.val()),n=t.parents(".form-group").find("small[data-bv-validator='callback']");return""==r?(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1):0==mobile_pattern.test(r)&&(n.text(getBundle(getBundleLanguage,"form.credit.card.number.invalid")),a=!1),a}}}},EmailAddress:{container:".EmailAddressErrMsg",validators:{callback:{message:"",callback:function(){var a=!0,t=e.find("input[name='EmailAddress']"),r=$.trim(t.val()),n=t.parents(".form-group").find("small[data-bv-validator='callback']");return""==r?(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1):0==emailreg.test(r)&&(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1),a}}}},userName:{container:".userNameErrMsg",validators:{callback:{message:"",callback:function(){var a=!0,t=e.find("input[name='userName']"),r=$.trim(t.val()),n=t.parents(".form-group").find("small[data-bv-validator='callback']");return""==r?(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1):isAccountNumeric(r)?(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1):plan_user.test(r)?(r.length<6||r.length>50)&&(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1):(n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1),a}}}},password:{container:".passwordErrMsg",validators:{callback:{message:"",callback:function(){var a=!0,t=e.find("input[name='password']"),r=$.trim(t.val()),n=t.parents(".form-group").find("small[data-bv-validator='callback']");if(""==r)n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1;else{var o=isValidPassword(r);if(1!=o)return n.text(o),!1}return a}}}},confirmPassword:{container:".confirmPasswordErrMsg",validators:{callback:{message:"",callback:function(){var a=!0,t=e.find("input[name='confirmPassword']"),r=$.trim(t.val()),n=t.parents(".form-group").find("small[data-bv-validator='callback']");if(""==r)n.text(getBundle(getBundleLanguage,"form.credit.card.number.empty")),a=!1;else{var o=passMatch($.trim(e.find("input[name='password']").val()),r);if(1!=o)return n.text(o),!1}return a}}}},checkbox1:{container:".checkbox1ErrMsg",validators:{notEmpty:{message:getBundle(getBundleLanguage,"form.credit.card.number.empty")}}}}})}function onClosed(e,a){if("cancel"==a&&""==$(this).val())$(this).parent().removeClass("is-dirty");else{$(this).parent().addClass("is-dirty");try{$("#ef-form-application").bootstrapValidator("updateStatus",$(this).attr("name"),"NOT_VALIDATED").bootstrapValidator("validateField",$(this).attr("name"))}catch(e){}}return!0}function changeAppointmentDate(e,a){var t=$(e).mobiscroll("getInst");t.clear(),t.option({valid:a,minDate:a[0]})}function showBubble(){$("#checkbox3").prop("checked")||$("#checkbox4").prop("checked")?$(".checkboxBubble").fadeIn():$(".checkboxBubble").fadeOut()}function renderRateTable(e,a,t,r,n){var o=$("#template .tbl_desktop").clone(),l=$("#template .tbl_mob_header").clone(),i=$("#template .tbl_mob").clone();n&&(o.addClass("pinkish-shade"),l.addClass("pinkish-shade"),i.addClass("pinkish-shade")),o.find(".premiumYear").text(r.premiumYear),l.find(".premiumYear").text(r.premiumYear),o.find(".rate").text(r.rate),i.find(".rate").text(r.rate),o.find(".totalPaid").text(r.totalPaid),i.find(".totalPaid").text(r.totalPaid),o.find(".accountValue").text(r.accountValue),i.find(".accountValue").text(r.accountValue),o.find(".deathBenefit").text(r.deathBenefit),i.find(".deathBenefit").text(r.deathBenefit),o.find(".riderValue").text(r.riderValue),i.find(".riderValue").text(r.riderValue),e.append(o),a.append(l),t.append(i)}function getParameterByName(e,a){a||(a=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),r=t.exec(a);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}var language="EN",typeId="SAVIE_OFFLINE",APIServer="",fwdApi={url:{getAvailableCentre:APIServer+context+"/api/appointment/centre",findAvailableDateByCentre:APIServer+context+"/api/appointment/timeSlotEntity",findAvailableTimeByCentre:APIServer+context+"/api/appointment/timeSlotEntity",appointment:APIServer+context+"/api/appointment",session:APIServer+context+"/api/member/session",login:APIServer+context+"/api/member/login",member:APIServer+context+"/api/member",forgotPassword:APIServer+context+"/api/member/forgotPassword",retrieveUserName:APIServer+context+"/api/member/retrieveUserName",planDetails:APIServer+context+"/api/provie/planDetails"}},isLogged=!1,userName="",IMG_DIR=context+"/resources/images";$(document).ready(function(){if($(".provie-plan-select").length>0){var e=new Date;(parseInt(e.getMonth()+1,10)+100).toString().substr(1),(parseInt(e.getDate(),10)+100).toString().substr(1);$("#plan-dob-datepicker").mobiscroll().calendar({controls:["date"],maxDate:new Date,showLabel:!0,dateOrder:"ddmmyy",dateFormat:"dd-mm-yyyy",theme:"mobiscroll",mode:"scroller",display:"bubble",onClosed:onClosed,lang:"en"==UILANGUAGE?"en_fwd":"zh_fwd"}),$("#plan-dob-datepicker").css("cursor","default");var a=new Date((new Date).setYear((new Date).getFullYear()-18));$("#plan-dob-datepicker").mobiscroll("setVal",a,!0),$("#type-of-extra-rider").change(function(e){var a=$(e.currentTarget).find("option:selected").data("cls");console.log(a),$(".er-color-swap").each(function(){$(this).removeClass("p50 p100 p500"),$(this).addClass(a)})}),$("#type-of-extra-rider").trigger("change"),$("#after-5-years-container").on("shown.bs.collapse",function(){$(window).resize()}),$(".rate-buttons button").click(function(){$(".rate-buttons button").removeClass("active"),$("#after-5-years .rate-table, #after-5-years .tbl-rate-mobile").hide(),$(this).addClass("active");var e=$(this).data("val");$("#rate-table-"+e).show(),$("#rate-table-"+e+"-mob").show()}),$("#plan-calculate-btn").click(function(){""!=$("#promoCode").val()&&$("#promoCodeErrorMsg").hasClass("hidden")?$("#promoCodeErrorMsg").removeClass("hidden"):(""==$("#promoCode").val()||$("#promoCodeErrorMsg").hasClass("hidden"))&&$("#promoCodeErrorMsg").addClass("hidden");var e=$("#type-of-payment option:selected").data("val").split("-");$.ajax({beforeSend:function(){$("#loading-overlay").modal("show")},url:fwdApi.url.planDetails,type:"get",data:{premium:"rp"==e[0]?$("#amount-slide-holder input").val():$("#plan-amount").val(),planCode:e[0],currency:e[1],dob:$("#plan-dob-datepicker").val(),rider:$("#type-of-extra-rider").val()},cache:!1,async:!1,error:function(){console.log("expected error")},success:function(e){if(e){e={planCode:"Provie-SP",currency:"HKD",rider:"PA",plans:[{premiumYear:1,rate:1,accountValue:10001,deathBenefit:10002,riderValue:10003,totalPaid:1e4},{premiumYear:2,rate:1.1,accountValue:10001,deathBenefit:10002,riderValue:10003,totalPaid:1e4},{premiumYear:3,rate:1.2,accountValue:10001,deathBenefit:10002,riderValue:10003,totalPaid:1e4},{premiumYear:4,rate:1.3,accountValue:10001,deathBenefit:10002,riderValue:10003,totalPaid:1e4},{premiumYear:5,rate:1.4,accountValue:10001,deathBenefit:10002,riderValue:10003,totalPaid:1e4}],creditRates:[{rate:0,plans:[{premiumYear:10,rate:0,accountValue:10001,deathBenefit:10002,riderValue:10003,totalPaid:1e4},{premiumYear:15,rate:0,accountValue:10001,deathBenefit:10002,riderValue:10003,totalPaid:1e4},{premiumYear:100,rate:0,accountValue:10001,deathBenefit:10002,riderValue:10003,totalPaid:1e4}]},{rate:1,plans:[{premiumYear:10,rate:0,accountValue:10001,deathBenefit:10002,riderValue:10003,totalPaid:1e4},{premiumYear:15,rate:0,accountValue:10001,deathBenefit:10002,riderValue:10003,totalPaid:1e4},{premiumYear:100,rate:0,accountValue:10001,deathBenefit:10002,riderValue:10003,totalPaid:1e4}]},{rate:2,plans:[{premiumYear:10,rate:2,accountValue:10001,deathBenefit:10002,riderValue:10003,totalPaid:1e4},{premiumYear:15,rate:2,accountValue:10001,deathBenefit:10002,riderValue:10003,totalPaid:1e4},{premiumYear:100,rate:2,accountValue:10001,deathBenefit:10002,riderValue:10003,totalPaid:1e4}]}]},$("table.tbl_desktop tbody").empty(),$("table.tbl_mob tbody").empty(),$("table.tbl_mob_header tbody").empty();for(var a=0;a<e.plans.length;a++){var t=e.plans[a];renderRateTable($("table.tbl_desktop tbody"),$("table.tbl_mob_header tbody"),$("table.tbl_mob tbody"),t,a%2==0)}if(e.creditRates){for(var r=0;r<3;r++){var n=$("#rate-table-"+r+" .table tbody"),o=$("#rate-table-"+r+"-mob table.sticky-header tbody"),l=$("#rate-table-"+r+"-mob table.overflow-body tbody");n.empty(),o.empty(),l.empty();for(var a=0;a<e.creditRates[r].plans.length;a++){var t=e.creditRates[r].plans[a];renderRateTable(n,o,l,t,a%2==0)}}$($(".rate-buttons button").get(1)).trigger("click")}}},complete:function(){$("#loading-overlay").modal("hide")}})}),$("#plan-calculate-btn").trigger("click")}if($(".provie-plan-appointment").length>0&&($("#app-date").mobiscroll().calendar({controls:["date"],minDate:new Date,showLabel:!0,dateOrder:"ddmmyy",dateFormat:"dd-mm-yyyy",invalid:["w0","w1","w2","w3","w4","w5","w6"],theme:"mobiscroll",mode:"scroller",display:"bubble",onSelect:function(e){$.ajax({beforeSend:function(){$("#loading-overlay").modal("show")},url:fwdApi.url.findAvailableTimeByCentre,type:"get",data:{type:typeId,date:e,centreCode:$("#centre").val()},cache:!1,async:!1,error:function(){alert("something error")},success:function(e){if(e)if($("#preferred-time").empty(),e.length>0)for(var a in e){var t=e[a],r=$("<option/>");r.data(t),r.val(t.timeSlot),r.text(t.timeSlot),$("#preferred-time").append(r)}else $("#preferedTimeIsNull").modal("show")},complete:function(){$("#loading-overlay").modal("hide")}})},lang:"en"==UILANGUAGE?"en_fwd":"zh_fwd"}),$(".btn-sub-pan-trigger").click(function(e){e.preventDefault(),$(e.currentTarget).parents(".panel-body").find(".sub-pan").removeClass("show"),$($(e.currentTarget).attr("href")).addClass("show")}),$(".btn-close-sub").click(function(e){e.preventDefault(),$("#sub-pan-login").addClass("show")}),$("#checkbox3, #checkbox4").change(function(){showBubble()}),$('[data-toggle="popover"]').popover(),bsvFormLogin($("#form-appointment-login")),bsvFormForgotUsername($("#form-appointment-forgot-username")),bsvFormForgotPwd($("#form-appointment-forgot-pwd")),bsvFormRegister($("#form-appointment-register")),$("#btn-appointment-confirm").on("click",function(){var e=!0;if($(".centreErrMsg, .app-dateErrMsg, .preferred-timeErrMsg, .generalErrMsg").empty(),""==$("#centre").val()&&(e=!1,$(".centreErrMsg").append($("<small/>").text("Please select customer service centre"))),""==$("#app-date").val()&&(e=!1,$(".app-dateErrMsg").append($("<small/>").text("Please select preferred date"))),""==$("#preferred-time").val()&&(e=!1,$(".preferred-timeErrMsg").append($("<small/>").text("Please select preferred time"))),isLogged||(e=!1,$(".generalErrMsg").append($("<small/>").text("Please select log in / register "))),e){var a={preferredDate:$("#app-date").val(),preferredTime:$("#preferred-time").val(),centreCode:$("#centre").val(),planCode:"PROVIE-SP",userName:userName,type:typeId};$.ajax({beforeSend:function(){$("#loading-overlay").modal("show")},url:fwdApi.url.appointment,type:"post",contentType:"application/json",data:JSON.stringify(a),cache:!1,async:!1,error:function(e){console.log(e),e.responseJSON&&$(".generalErrMsg").append($("<small/>").text(e.responseJSON.message))},success:function(e){e&&(window.location.href=context+"/"+language+"/savings-insurance/provie/confirmation-appointment-sp?referenceNum="+e.referenceNum)},complete:function(){$("#loading-overlay").modal("hide")}})}}),$("#centre").change(function(e){var a,t=$(e.currentTarget);t.find("option:selected").each(function(){a=$(this).data()}),a&&($(".img-centre").attr("src",IMG_DIR+"/csc/"+a.photo),$(".centre-address").text(a.address),$(".viewmap-link").attr("href",a.map),$.ajax({beforeSend:function(){$("#loading-overlay").modal("show")},url:fwdApi.url.findAvailableDateByCentre,type:"get",contentType:"application/json",data:{type:typeId,centreCode:a.serviceCentreCode,date:""},cache:!1,async:!1,error:function(){alert("something error")},success:function(e){if($("#preferedTimeIsNull").modal("show"),e)if(e.length>0){var a=[];for(var t in e){var r=e[t],n=r.date.split("-");a.push(new Date(n[2],n[1]-1,n[0]))}changeAppointmentDate("#app-date",a)}else $("#preferedTimeIsNull").modal("show")},complete:function(){$("#loading-overlay").modal("hide")}}))}),$.ajax({url:fwdApi.url.session,type:"get",contentType:"application/json",data:{typeId:typeId,language:language},cache:!1,async:!1,error:function(){$(".before-login").show()},success:function(e){e&&(isLogged=!0,$(".after-login").find(".fld-val").text(e.fullName),userName=e.userName,$(".after-login").show(),$("#btn-appointment-confirm").show())}}),$.ajax({beforeSend:function(){$("#loading-overlay").modal("show")},url:fwdApi.url.getAvailableCentre,type:"get",contentType:"application/json",data:{type:typeId,language:language},cache:!1,async:!1,error:function(){alert("something error")},success:function(e){if(e)if($("#centre").empty(),e.length>0){for(var a in e){var t=e[a];console.log(t);var r=$("<option/>");r.text(t.serviceCentreName),r.val(t.serviceCentreCode),r.data(t),$("#centre").append(r)}$("#centre").change()}else $("#fullyBooked").modal("show")},complete:function(){$("#loading-overlay").modal("hide")}})),$("#appointment-confirmation-page").length>0){var t;try{t=getParameterByName("referenceNum")}catch(e){}$(".policy-number").text(t),$.ajax({url:fwdApi.url.appointment+"/"+t,type:"get",contentType:"application/json",cache:!1,async:!1,error:function(){$(".before-login").show()},success:function(e){e&&console.log(e)}})}});